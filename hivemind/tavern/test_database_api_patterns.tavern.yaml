---
  test_name: Hivemind database_api.find_comments patterns test

  marks:
    - patterntest

  includes:
    - !include common.yaml

  stages:
    - name: find_comments
      request:
        url: "{service.proto:s}://{service.server:s}:{service.port}/"
        method: POST
        headers:
          content-type: application/json
        json:
          jsonrpc: "2.0"
          id: 1
          method: "database_api.find_comments"
          params: {"comments":[["steemit","firstpost"]]}
      response:
        status_code: 200
        verify_response_with:
          function: validate_response:compare_response_with_pattern
          extra_kwargs:
            method: "find_comments"
            directory: "database_api_patterns"

########################  CASHOUT TIME  ########################
---
test_name: Hivemind database_api.list_comments patterns test order "by_cashout_time" date and author

marks:
  - patterntest
  - failing
  - xfail # shows error when there is only one of optional value (first)

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_cashout_time
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["1969-12-31T23:59:59", "etcmike", ""],
            "limit": 10,
            "order": "by_cashout_time",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_not_found_by_account"
          directory: "database_api_patterns"
          error_response: true
          ignore_tags: ["timestamp"]

---
test_name: Hivemind database_api.list_comments patterns test order "by_cashout_time" date and permlink

marks:
  - patterntest
  - failing
  - xfail # shows error when there is only one of optional value (first)

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_cashout_time
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start":
              [
                "1969-12-31T23:59:59",
                "",
                "re-bullionstackers-screen-it-tab-it-what-are-they-20160829t061254603z",
              ],
            "limit": 10,
            "order": "by_cashout_time",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_not_found_by_permlink"
          directory: "database_api_patterns"
          error_response: true
          ignore_tags: ["timestamp"]

---
test_name: Hivemind database_api.list_comments patterns test order "by_cashout_time" very future date

marks:
  - patterntest # "2038-01-19T03:14:08" is the first timestamp that is "too far" for old fat node, but SQL has normal timestamps so we won't be generating error here

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_cashout_time
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["2050-07-08T00:45:15", "", ""],
            "limit": 10,
            "order": "by_cashout_time",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_future_date"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_cashout_time" no data

marks:
  - patterntest
  - failing
  - xfail

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_cashout_time
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          { "start": ["", "", ""], "limit": 10, "order": "by_cashout_time" }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_day_of_the_month_out_of_range"
          directory: "database_api_patterns"
          error_response: true
          ignore_tags: ["timestamp"]


########################  PERMLINK  ########################
---
test_name: Hivemind database_api.list_comments patterns test order "by_permlink" only author

marks:
  - patterntest

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_permlink
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params: { "start": ["gtg", ""], "limit": 10, "order": "by_permlink" }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_permlink"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_permlink" good params

marks:
  - patterntest
  - failing
  - xfail # abs_rshares/vote_rshares prior to first payout

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_permlink
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start":
              [
                "skypilot",
                "an-introduction-to-where-eagles-fly-the-american-wilderness-expedition-by-zedekiah-morse",
              ],
            "limit": 10,
            "order": "by_permlink",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_permlink_good_params"
          directory: "database_api_patterns"


########################  PARENT  ########################
---
test_name: Hivemind database_api.list_comments patterns test order "by_parent"

marks:
  - patterntest

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_parent
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["gtg", "hello-world", "", ""],
            "limit": 10,
            "order": "by_parent",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_parent"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_parent" no data

marks:
  - patterntest # first 2 params are required

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_parent
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["", "", "", ""],
            "limit": 10,
            "order": "by_parent",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_parent_no_data"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_parent" no data

marks:
  - patterntest

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_parent
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["vi1son", "", "", ""],
            "limit": 10,
            "order": "by_parent",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_parent_parent_author"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_parent" required data

marks:
  - patterntest

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_parent
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["knozaki2015", "re-givemeyoursteem-winners-of-steemit-food-challenge-3-desserts-to-die-for-20160828t181032961z", "", ""],
            "limit": 10,
            "order": "by_parent",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_parent_required_data"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_parent" all data

marks:
  - patterntest

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_parent
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["allasyummyfood", "re-givemeyoursteem-winners-of-steemit-food-challenge-3-desserts-to-die-for-20160829t004616466z", "vlad", "re-allasyummyfood-re-givemeyoursteem-winners-of-steemit-food-challenge-3-desserts-to-die-for-20160829t011002757z"],
            "limit": 10,
            "order": "by_parent",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_parent_all_data"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_parent" not full parent_permlink

marks:
  - patterntest

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_parent
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["allasyummy", "re-givemeyoursteem-winner", "vlad", "re-allasyummyfood-re-givemeyoursteem-winners-of-steemit-food-challenge-3-desserts-to-die-for-20160829t011002757z"],
            "limit": 10,
            "order": "by_parent",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_parent_not_full_data"
          directory: "database_api_patterns"

########################  AUTHOR LAST UPDATE  ########################
---
test_name: Hivemind database_api.list_comments patterns test order "by_author_last_update" correct date

marks:
  - patterntest # incomparable with original (bug in fat node using wrong index)

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_author_last_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["", "2016-08-28T17:15:12", "", ""],
            "limit": 10,
            "order": "by_author_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_author_last_update_corr_date"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_author_last_update" correct date author and permlink

marks:
  - patterntest # incomparable with original (bug in fat node using wrong index)

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_author_last_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["", "2016-08-28T17:15:12", "givemeyoursteem", "winners-of-steemit-food-challenge-3-desserts-to-die-for"],
            "limit": 10,
            "order": "by_author_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_author_last_update_corr_dap"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_author_last_update" correct author and date

marks:
  - patterntest # incomparable with original (bug in fat node using wrong index)

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_author_last_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["givemeyoursteem", "2016-08-28T17:15:12", "", ""],
            "limit": 10,
            "order": "by_author_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_author_last_update_corr_author_date"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_author_last_update" not full author and corr date

marks:
  - patterntest # incomparable with original (bug in fat node using wrong index); output should be the same as prev test or with completely diff author

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_author_last_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["givemeyo", "2016-08-28T17:15:12", "", ""],
            "limit": 10,
            "order": "by_author_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_author_last_update_author_date"
          directory: "database_api_patterns"

########################  LAST UPDATE  ########################
---
test_name: Hivemind database_api.list_comments patterns test order "by_last_update"

marks:
  - patterntest
  - failing
  - xfail

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          { "start": ["", "", "", ""], "limit": 10, "order": "by_last_update" }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_day_out_of_range_empty"
          directory: "database_api_patterns"
          error_response: true
          ignore_tags: ["timestamp"]
---
test_name: Hivemind database_api.list_comments patterns test order "by_last_update" date in author

marks:
  - patterntest # first arg is author, not date (error about date)
  - failing
  - xfail


includes:
  - !include common.yaml

stages:
  - name: list_comments_by_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["2016-08-24T21:29:42", "", "", ""],
            "limit": 10,
            "order": "by_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_day_out_of_range_start_0"
          directory: "database_api_patterns"
          error_response: true
          ignore_tags: ["timestamp"]
---
test_name: Hivemind database_api.list_comments patterns test order "by_last_update" good date

marks:
  - patterntest
  - failing
  - xfail # differences in rshares/weight after empty payout


includes:
  - !include common.yaml

stages:
  - name: list_comments_by_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["", "2016-08-24T21:29:42", "", ""],
            "limit": 10,
            "order": "by_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_last_update_good_date"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_last_update" very future date

marks:
  - patterntest # "2038-01-19T03:14:08" is the first timestamp that is "too far" for old fat node, but SQL has normal timestamps so we won't be generating error here
                # on a side note it generally makes no sense to run it without parent author specification

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["", "2050-08-24T21:29:42", "", ""],
            "limit": 10,
            "order": "by_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_day_out_of_range_start_2"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_last_update" future date

marks:
  - patterntest # show last comments in base

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["", "2022-08-24T21:29:42", "", ""],
            "limit": 10,
            "order": "by_last_update",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_by_last_update_future_date"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_comments patterns test order "by_last_update" wrong day

marks:
  - patterntest
  - failing
  - xfail

includes:
  - !include common.yaml

stages:
  - name: list_comments_by_update
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_comments"
        params:
          {
            "start": ["", "2016-04-66T21:29:42", "", ""],
            "limit": 10,
            "order": "by_last_update"
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_comments_day_out_of_range_start_3"
          directory: "database_api_patterns"
          error_response: true
          ignore_tags: ["timestamp"]


---
test_name: Hivemind database_api.list_votes patterns test order "by_voter_comment"

marks:
  - patterntest # show last comments in base

includes:
  - !include common.yaml

stages:
  - name: list_votes_by_voter_comment
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_votes"
        params:
          {
            "start":["nxt2", "roelandp", "tldr-an-exploration-in-steem-botting-what-i-learned-since-it-s-inception-and-downfall-over-the-course-of-20-hours"],
            "limit": 10,
            "order": "by_voter_comment",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_votes_by_voter_comment"
          directory: "database_api_patterns"

---
test_name: Hivemind database_api.list_votes patterns test order "by_comment_voter"

marks:
  - patterntest # show last comments in base

includes:
  - !include common.yaml

stages:
  - name: list_votes_by_comment_voter
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.list_votes"
        params:
          {
            "start":["roelandp", "tldr-an-exploration-in-steem-botting-what-i-learned-since-it-s-inception-and-downfall-over-the-course-of-20-hours", "nxt2"],
            "limit": 10,
            "order": "by_comment_voter",
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "list_votes_by_comment_voter"
          directory: "database_api_patterns"

test_name: Hivemind database_api.find_votes patterns test

marks:
  - patterntest

includes:
  - !include common.yaml

stages:
  - name: find_votes
    request:
      url: "{service.proto:s}://{service.server:s}:{service.port}/"
      method: POST
      headers:
        content-type: application/json
      json:
        jsonrpc: "2.0"
        id: 1
        method: "database_api.find_votes"
        params:
          {
            "author":"roelandp",
            "permlink":"tldr-an-exploration-in-steem-botting-what-i-learned-since-it-s-inception-and-downfall-over-the-course-of-20-hours"
          }
    response:
      status_code: 200
      verify_response_with:
        function: validate_response:compare_response_with_pattern
        extra_kwargs:
          method: "find_votes"
          directory: "database_api_patterns"
